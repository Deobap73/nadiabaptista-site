generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  CLIENT
}

enum PostStatus {
  DRAFT
  PUBLISHED
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  role         UserRole @default(CLIENT)
  passwordHash String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  posts     Post[]
  conversationsA Conversation[] @relation("ConversationUserA")
  conversationsB Conversation[] @relation("ConversationUserB")
  messages  Message[]
}


model Category {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  posts     Post[]
}

model Post {
  id        String     @id @default(cuid())
  title     String
  slug      String     @unique
  excerpt   String?
  content   String
  status    PostStatus @default(DRAFT)

  coverImageUrl      String?
  coverImagePublicId String?

  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  authorId String?
  author   User? @relation(fields: [authorId], references: [id])

  @@index([status, publishedAt])
  @@index([categoryId])
}

model Diploma {
  id        String   @id @default(cuid())
  title     String
  issuer    String?
  dateLabel String?
  description String?

  imageUrl      String?
  imagePublicId String?

  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
}

model Achievement {
  id        String   @id @default(cuid())
  title     String
  dateLabel String?
  description String?

  imageUrl      String?
  imagePublicId String?

  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
}

model AcademicProject {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  summary   String?
  content   String?

  imageUrl      String?
  imagePublicId String?

  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
}

model PracticalExperience {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  summary   String?
  content   String?

  imageUrl      String?
  imagePublicId String?

  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
}

model ConferenceSeminar {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  dateLabel String?
  location  String?
  content   String?

  imageUrl      String?
  imagePublicId String?

  sortOrder Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sortOrder])
}

model Conversation {
  id        String   @id @default(cuid())

  userAId   String
  userBId   String
  userA     User     @relation("ConversationUserA", fields: [userAId], references: [id])
  userB     User     @relation("ConversationUserB", fields: [userBId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages  Message[]

  @@unique([userAId, userBId])
  @@index([updatedAt])
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])

  senderId String
  sender   User   @relation(fields: [senderId], references: [id])

  body     String

  readAt   DateTime?
  createdAt DateTime @default(now())

  @@index([conversationId, createdAt])
  @@index([senderId])
}
